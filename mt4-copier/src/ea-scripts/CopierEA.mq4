//+------------------------------------------------------------------+\n//|                                                     CopierEA.mq4   |\n//|                        Copyright 2025, MT4 Copier                  |\n//|                                                                    |\n//+------------------------------------------------------------------+\n#property copyright "Copyright 2025, MT4 Copier"\n#property link      ""\n#property version   "1.00"\n#property strict\n\n// 全局变量\nexttern string   ServerAddress = "127.0.0.1"; // 本地服务器地址\nextern int      ServerPort = 8888;           // 服务器端口\nint             Socket = -1;                 // Socket句柄\n\n//+------------------------------------------------------------------+\n//| Expert initialization function                                     |\n//+------------------------------------------------------------------+\nint OnInit()\n{\n   // 初始化Socket连接\n   Socket = SocketCreate(SOCKET_DEFAULT);\n   if(Socket < 0)\n   {\n      Print("Socket创建失败, error: ", GetLastError());\n      return(INIT_FAILED);\n   }\n   \n   // 连接到本地服务器\n   bool connected = SocketConnect(Socket, ServerAddress, ServerPort, 1000);\n   if(!connected)\n   {\n      Print("连接服务器失败, error: ", GetLastError());\n      return(INIT_FAILED);\n   }\n   \n   Print("EA初始化成功，已连接到服务器");\n   return(INIT_SUCCEEDED);\n}\n\n//+------------------------------------------------------------------+\n//| Expert deinitialization function                                   |\n//+------------------------------------------------------------------+\nvoid OnDeinit(const int reason)\n{\n   // 关闭Socket连接\n   if(Socket >= 0)\n   {\n      SocketClose(Socket);\n   }\n}\n\n//+------------------------------------------------------------------+\n//| Expert tick function                                              |\n//+------------------------------------------------------------------+\nvoid OnTick()\n{\n   // 发送当前账户信息到服务器\n   string accountInfo = StringFormat(\n      "ACCOUNT|%d|%s|%.2f|%.2f",\n      AccountNumber(),\n      AccountCompany(),\n      AccountBalance(),\n      AccountEquity()\n   );\n   \n   SocketSend(Socket, accountInfo);\n   \n   // 接收服务器指令\n   string command = SocketReceive(Socket);\n   if(StringLen(command) > 0)\n   {\n      ExecuteCommand(command);\n   }\n}\n\n//+------------------------------------------------------------------+\n//| 执行服务器发来的交易指令                                           |\n//+------------------------------------------------------------------+\nvoid ExecuteCommand(string command)\n{\n   // 解析指令\n   string parts[];\n   int count = StringSplit(command, '|', parts);\n   \n   if(count < 2) return;\n   \n   string cmd = parts[0];\n   \n   if(cmd == "OPEN")\n   {\n      // 开仓指令\n      string symbol = parts[1];\n      int type = StringToInteger(parts[2]);\n      double volume = StringToDouble(parts[3]);\n      double price = StringToDouble(parts[4]);\n      \n      OrderSend(symbol, type, volume, price, 3, 0, 0);\n   }\n   else if(cmd == "CLOSE")\n   {\n      // 平仓指令\n      int ticket = StringToInteger(parts[1]);\n      OrderClose(ticket, OrderLots(), Bid, 3);\n   }\n}